SUBDIRS =       libtrayicon

EXTRA_DIST = $(srcdir)/generated/*.cs $(srcdir)/libtrayicon-sources.xml $(srcdir)/Egg.metadata

ASSEMBLY =	TrayIcon
LIBRARY =	$(ASSEMBLY).dll
API =		libtrayicon-api.xml

INCLUDE_API=	$(GTK_SHARP_PREFIX)/share/gapi/art-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/pango-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/atk-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/gnome-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/gtk-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/gdk-api.xml	\
		$(GTK_SHARP_PREFIX)/share/gapi/gdk-symbols.xml

all: $(LIBRARY)

$(LIBRARY):
	mcs --unsafe --target library $(BEAGLE_UI_LIBS) --recurse $(srcdir)/generated/*.cs -o $(LIBRARY) $(TIMELINE_BROWSER_LIBS)

generated-stamp: $(API)
	gapi-fixup --api=$(API) --metadata=Egg.metadata && \
	gapi-codegen --include $(INCLUDE_API) --generate $(API) \
	--outdir=generated --customdir=. --assembly-name=$(ASSEMBLY) \
	&& touch generated-stamp

$(API):
	PERLLIB=/usr/share/perl5 gapi-parser libtrayicon-sources.xml

install-exec-local: $(LIBRARY)
	$(mkinstalldirs) $(DESTDIR)$(libdir)
	$(INSTALL_PROGRAM) $(LIBRARY) $(DESTDIR)$(libdir)

uninstall-local:
	rm -f $(DESTDIR)$(libdir)/$(LIBRARY)

clean-local:
	rm -f generated-stamp
	rm -f $(DESTDIR)$(LIBRARY)
	rm -f $(DESTDIR)$(API)

maintainer-clean-local:
	rm -rf $(COMMON_MAINTAINER_CLEAN_FILES)

