#!@bash@

if [ -e ./@target@ ] && [ -e ./Makefile.am ] ; then
    echo "*** Running uninstalled @target@ ***"
    THIS_PATH="../Util:../BeagleClient:."
    THIS_EXE="./@target@"

    export MONO_PATH="../Util:../BeagleClient:$MONO_PATH"
    export LD_LIBRARY_PATH="../glue/.libs:$LD_LIBRARY_PATH"

    # In BEAGLE_FILTER_PATH, a trailing ':' means "append the default path".
    if [ -n "$BEAGLE_FILTER_PATH" ]; then
	export BEAGLE_FILTER_PATH="../Filters:$BEAGLE_FILTER_PATH"
    else
	export BEAGLE_FILTER_PATH="../Filters"
    fi

else
    THIS_PATH="@pkglibdir@"
    THIS_EXE="@pkglibdir@/@target@"
fi

if [ -n "$_GET_ON_THE_HEAP_BUDDY_BANDWAGON" ]; then
   n=1
   while [ -e $BEAGLE_HEAP_BUDDY_DIR/outfile.helper.$n ]; do
	 n=$(($n+1))
   done	
   MONO_EXTRA_ARGS="--profile=heap-buddy:$BEAGLE_HEAP_BUDDY_DIR/outfile.helper.$n $MONO_EXTRA_ARGS"
fi

export MONO_GAC_PREFIX="@gacprefix@:$MONO_GAC_PREFIX"
export MONO_PATH="$THIS_PATH:$MONO_PATH"

CMDLINE="mono --debug $MONO_EXTRA_ARGS $THIS_EXE $@"

PROCESS_NAME="mono-beagled-helper"
exec -a $PROCESS_NAME $CMDLINE

