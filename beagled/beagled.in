#!/bin/sh

if [ -e ./@target@ ] && [ -e ./Makefile.am ] ; then
    echo "Running uninstalled @target@ in the foreground."

    export MONO_PATH="../Util:../BeagleClient:$MONO_PATH"
    export LD_LIBRARY_PATH="../glue/.libs:$LD_LIBRARY_PATH"

    # In BEAGLE_FILTER_PATH, a trailing ':' means "append the default path".
    if [ -n "$BEAGLE_FILTER_PATH" ]; then
	export BEAGLE_FILTER_PATH="../Filters:$BEAGLE_FILTER_PATH"
    else
	export BEAGLE_FILTER_PATH="../Filters"
    fi

    TARGET_EXE="./@target@"
    EXTRA_ARGS="--nofork --out"
else
    export MONO_PATH="@pkglibdir@:$MONO_PATH"
    export LD_LIBRARY_PATH="@pkglibdir@:$LD_LIBRARY_PATH"
    TARGET_EXE="@pkglibdir@/@target@"
    EXTRA_ARGS=""
fi

export MONO_GAC_PREFIX="@gacprefix@:$MONO_GAC_PREFIX"

exec -a mono-beagled mono --debug $MONO_EXTRA_ARGS $TARGET_EXE $EXTRA_ARGS "$@"
